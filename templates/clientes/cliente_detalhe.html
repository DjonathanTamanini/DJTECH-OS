{% extends 'base.html' %}

{% block title %}{{ cliente.nome }} - DJTECH-OS{% endblock %}

{% block page_title %}{{ cliente.nome }}{% endblock %}
{% block page_subtitle %}Detalhes do cliente{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <a href="{% url 'cliente_lista' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar
        </a>
        <a href="{% url 'cliente_editar' cliente.pk %}" class="btn btn-primary">
            <i class="bi bi-pencil"></i> Editar
        </a>
        <a href="{% url 'cliente_deletar' cliente.pk %}" class="btn btn-danger">
            <i class="bi bi-trash"></i> Excluir
        </a>
    </div>
</div>

<div class="row">
    <!-- Informações do Cliente -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-person-badge"></i> Informações do Cliente
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" width="40%"><strong>Nome:</strong></td>
                        <td>{{ cliente.nome }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>CPF/CNPJ:</strong></td>
                        <td>{{ cliente.cpf_cnpj }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>Email:</strong></td>
                        <td>{{ cliente.email|default:"-" }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>Telefone Principal:</strong></td>
                        <td>{{ cliente.telefone_principal }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>Telefone Secundário:</strong></td>
                        <td>{{ cliente.telefone_secundario|default:"-" }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>Status:</strong></td>
                        <td>
                            {% if cliente.ativo %}
                                <span class="badge bg-success">Ativo</span>
                            {% else %}
                                <span class="badge bg-secondary">Inativo</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted"><strong>Cadastrado em:</strong></td>
                        <td>{{ cliente.data_cadastro|date:"d/m/Y H:i" }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Endereço -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-geo-alt"></i> Endereço
                </h5>
            </div>
            <div class="card-body">
                {% if cliente.cep %}
                    <table class="table table-borderless">
                        <tr>
                            <td class="text-muted" width="40%"><strong>CEP:</strong></td>
                            <td>{{ cliente.cep }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><strong>Logradouro:</strong></td>
                            <td>{{ cliente.logradouro|default:"-" }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><strong>Número:</strong></td>
                            <td>{{ cliente.numero|default:"-" }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><strong>Complemento:</strong></td>
                            <td>{{ cliente.complemento|default:"-" }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><strong>Bairro:</strong></td>
                            <td>{{ cliente.bairro|default:"-" }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><strong>Cidade/UF:</strong></td>
                            <td>{{ cliente.cidade|default:"-" }} - {{ cliente.estado|default:"-" }}</td>
                        </tr>
                    </table>
                {% else %}
                    <p class="text-muted text-center py-4">
                        <i class="bi bi-geo-alt" style="font-size: 48px;"></i><br>
                        Endereço não cadastrado
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Observações -->
{% if cliente.observacoes %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-chat-left-text"></i> Observações
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-0">{{ cliente.observacoes|linebreaks }}</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Histórico de Ordens de Serviço -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history"></i> Histórico de Ordens de Serviço
                </h5>
            </div>
            <div class="card-body">
                {% if ordens_servico %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>OS</th>
                                    <th>Equipamento</th>
                                    <th>Status</th>
                                    <th>Data Entrada</th>
                                    <th>Valor Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for os in ordens_servico %}
                                <tr>
                                    <td><strong>{{ os.numero_os }}</strong></td>
                                    <td>{{ os.get_tipo_equipamento_display }} - {{ os.marca }} {{ os.modelo }}</td>
                                    <td>
                                        <span class="badge badge-status bg-primary">
                                            {{ os.get_status_display }}
                                        </span>
                                    </td>
                                    <td>{{ os.data_entrada|date:"d/m/Y" }}</td>
                                    <td>R$ {{ os.valor_total|floatformat:2 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">
                        <i class="bi bi-file-earmark-text" style="font-size: 48px;"></i><br>
                        Nenhuma ordem de serviço cadastrada para este cliente
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
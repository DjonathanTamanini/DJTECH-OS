{% extends 'base.html' %}

{% block title %}{{ titulo }} - DJTECH-OS{% endblock %}

{% block page_title %}{{ titulo }}{% endblock %}
{% block page_subtitle %}
    {% if peca %}Editar informações da peça{% else %}Cadastrar nova peça no estoque{% endif %}
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-box"></i> {{ titulo }}
                </h5>
            </div>
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-upc-scan"></i> Identificação
                            </h6>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="{{ form.part_number.id_for_label }}" class="form-label">
                                Part Number (Fabricante)
                            </label>
                            {{ form.part_number }}
                            {% if form.part_number.errors %}
                                <div class="text-danger small">{{ form.part_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.nome.id_for_label }}" class="form-label">
                                Nome da Peça *
                            </label>
                            {{ form.nome }}
                            {% if form.nome.errors %}
                                <div class="text-danger small">{{ form.nome.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="{{ form.categoria.id_for_label }}" class="form-label">
                                Categoria *
                            </label>
                            {{ form.categoria }}
                            <small class="text-muted d-block mt-1">
                                <a href="{% url 'categoria_lista' %}" target="_blank">Gerenciar categorias</a>
                            </small>
                            {% if form.categoria.errors %}
                                <div class="text-danger small">{{ form.categoria.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="col-md-12 mb-3">
                            <label for="{{ form.descricao.id_for_label }}" class="form-label">
                                Descrição Detalhada
                            </label>
                            {{ form.descricao }}
                            {% if form.descricao.errors %}
                                <div class="text-danger small">{{ form.descricao.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-boxes"></i> Parâmetros de Estoque
                            </h6>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.quantidade_minima.id_for_label }}" class="form-label">
                                Estoque Mínimo (Alerta) *
                            </label>
                            {{ form.quantidade_minima }}
                            <small class="text-muted d-block">O sistema avisará quando o saldo for igual ou menor</small>
                            {% if form.quantidade_minima.errors %}
                                <div class="text-danger small">{{ form.quantidade_minima.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-8 mb-3">
                            <label for="{{ form.localizacao.id_for_label }}" class="form-label">
                                Localização Física
                            </label>
                            {{ form.localizacao }}
                            {% if form.localizacao.errors %}
                                <div class="text-danger small">{{ form.localizacao.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-currency-dollar"></i> Precificação
                            </h6>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.margem_lucro.id_for_label }}" class="form-label">
                                Margem de Lucro (%) *
                            </label>
                            <div class="input-group">
                                {{ form.margem_lucro }}
                                <span class="input-group-text">%</span>
                            </div>
                            <small class="text-muted">Calculada sobre o último preço de compra</small>
                            {% if form.margem_lucro.errors %}
                                <div class="text-danger small">{{ form.margem_lucro.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-8 mb-3">
                            <label class="form-label">Preço de Venda</label>
                            <div class="alert alert-info py-2 px-3 mb-0">
                                <i class="bi bi-info-circle"></i> O preço de venda final será atualizado automaticamente sempre que uma nova entrada financeira for lançada para esta peça.
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-truck"></i> Fornecedor Principal
                            </h6>
                        </div>
                        
                        <div class="col-md-9 mb-3">
                            <label for="{{ form.fornecedor_principal.id_for_label }}" class="form-label">
                                Fornecedor Sugerido
                            </label>
                            {{ form.fornecedor_principal }}
                        </div>
                        
                        <div class="col-md-3 mb-3 d-flex align-items-end">
                            <div class="form-check mb-2">
                                {{ form.ativo }}
                                <label class="form-check-label" for="{{ form.ativo.id_for_label }}">
                                    Peça Ativa
                                </label>
                            </div>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label for="{{ form.observacoes.id_for_label }}" class="form-label">Observações</label>
                            {{ form.observacoes }}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <hr>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-check-circle"></i> Salvar Registro
                            </button>
                            <a href="{% url 'peca_lista' %}" class="btn btn-secondary btn-lg">
                                <i class="bi bi-x-circle"></i> Voltar
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}